import{r as e,a as t,g as s}from"./vendor-Z2Iecplj.js";import{r as a,B as n,P as i,D as r,U as o,a as l,C as c,b as d,T as m,c as u,E as g,d as p,F as h,S as x,e as y,I as f,f as b,L as N,Z as v,g as S,h as j,i as w,j as C,M as E,R as A}from"./icons-TJ-0hnuw.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var D,I,P={exports:{}},T={};var O,$=(I||(I=1,P.exports=function(){if(D)return T;D=1;var t=e(),s=Symbol.for("react.element"),a=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function o(e,t,a){var o,l={},c=null,d=null;for(o in void 0!==a&&(c=""+a),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)n.call(t,o)&&!r.hasOwnProperty(o)&&(l[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===l[o]&&(l[o]=t[o]);return{$$typeof:s,type:e,key:c,ref:d,props:l,_owner:i.current}}return T.Fragment=a,T.jsx=o,T.jsxs=o,T}()),P.exports),R={};var L=function(){if(O)return R;O=1;var e=t();return R.createRoot=e.createRoot,R.hydrateRoot=e.hydrateRoot,R}();const _=({onPatternsUpdated:e})=>{const[t,s]=a.useState(()=>{const e=localStorage.getItem("trainingExamples");return e?JSON.parse(e):[]}),[h,x]=a.useState({admissionNote:"",progressNotes:"",consultantNotes:"",procedureNote:"",finalNote:"",completedSummary:"",pathology:"",notes:""}),[y,f]=a.useState(!1),[b,N]=a.useState(null),[v,S]=a.useState(""),[j,w]=a.useState(""),C=a.useCallback(e=>{const t={structure:[],terminology:[],clinical:[],formatting:[]};if(e.completedSummary){const s=e.completedSummary.split(/\n(?=[A-Z][A-Z\s]+:)/);t.structure=s.map(e=>{const t=e.match(/^([A-Z][A-Z\s]+):/);return t?t[1].trim():null}).filter(Boolean),e.completedSummary.includes("â€¢")&&t.formatting.push("bullet_list_preferred"),e.completedSummary.match(/\d+\./)&&t.formatting.push("numbered_list_used"),e.completedSummary.match(/\n\n/g)?.length>3&&t.formatting.push("section_spacing_used")}const s=[e.admissionNote,e.progressNotes,e.consultantNotes,e.procedureNote,e.finalNote,e.completedSummary].join(" ");return["POD","post-op","preop","intraop","s/p","w/","c/o","pt","patient","tolerated","uneventful","stable","discharged","follow-up","follow up","f/u"].forEach(e=>{const a=new RegExp(`\\b${e}\\b`,"gi"),n=s.match(a);n&&n.length>0&&t.terminology.push({term:e,frequency:n.length})}),e.pathology&&t.clinical.push({pathology:e.pathology,hasConsultant:!!e.consultantNotes,hasProcedure:!!e.procedureNote,summaryLength:e.completedSummary?.length||0}),t},[]),E=a.useCallback(()=>{const e={commonStructure:{},preferredTerminology:{},pathologySpecificPatterns:{},formattingPreferences:{},totalExamples:t.length};return t.forEach(t=>{const s=C(t);s.structure.forEach(t=>{e.commonStructure[t]=(e.commonStructure[t]||0)+1}),s.terminology.forEach(({term:t,frequency:s})=>{e.preferredTerminology[t]||(e.preferredTerminology[t]={count:0,totalFreq:0}),e.preferredTerminology[t].count+=1,e.preferredTerminology[t].totalFreq+=s}),s.clinical.forEach(t=>{const s=t.pathology.toLowerCase();e.pathologySpecificPatterns[s]||(e.pathologySpecificPatterns[s]={count:0,avgSummaryLength:0,consultantRate:0,procedureRate:0});const a=e.pathologySpecificPatterns[s];a.count+=1,a.avgSummaryLength=(a.avgSummaryLength*(a.count-1)+t.summaryLength)/a.count,a.consultantRate=(a.consultantRate*(a.count-1)+(t.hasConsultant?1:0))/a.count,a.procedureRate=(a.procedureRate*(a.count-1)+(t.hasProcedure?1:0))/a.count}),s.formatting.forEach(t=>{e.formattingPreferences[t]=(e.formattingPreferences[t]||0)+1})}),e},[t,C]),A=a.useCallback(()=>{if(!h.completedSummary)return void w("Completed summary is required");const a={id:Date.now().toString(),timestamp:(new Date).toISOString(),...h},n=[...t,a];s(n),localStorage.setItem("trainingExamples",JSON.stringify(n));const i=E();localStorage.setItem("globalLearningPatterns",JSON.stringify(i)),e&&e(i),S(`Training example added! Total examples: ${n.length}`),setTimeout(()=>S(""),3e3),x({admissionNote:"",progressNotes:"",consultantNotes:"",procedureNote:"",finalNote:"",completedSummary:"",pathology:"",notes:""}),f(!1)},[h,t,E,e]),D=a.useCallback(a=>{const n=t.filter(e=>e.id!==a);s(n),localStorage.setItem("trainingExamples",JSON.stringify(n));const i=E();localStorage.setItem("globalLearningPatterns",JSON.stringify(i)),e&&e(i),S("Example deleted and patterns updated"),setTimeout(()=>S(""),3e3)},[t,E,e]),I=a.useCallback(()=>{const e=JSON.stringify(t,null,2),s=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download=`training-examples-${(new Date).toISOString().split("T")[0]}.json`,n.click(),URL.revokeObjectURL(a)},[t]),P=a.useCallback(a=>{const n=a.target.files[0];if(!n)return;const i=new FileReader;i.onload=a=>{try{const n=JSON.parse(a.target.result);if(!Array.isArray(n))return void w("Invalid file format");const i=[...t,...n];s(i),localStorage.setItem("trainingExamples",JSON.stringify(i));const r=E();localStorage.setItem("globalLearningPatterns",JSON.stringify(r)),e&&e(r),S(`Imported ${n.length} examples`),setTimeout(()=>S(""),3e3)}catch(n){w("Failed to import: "+n.message)}},i.readAsText(n)},[t,E,e]);return a.useCallback(()=>E(),[E]),$.jsxs("div",{className:"space-y-4",children:[$.jsxs("div",{className:"flex items-center justify-between",children:[$.jsxs("div",{className:"flex items-center gap-2",children:[$.jsx(n,{className:"h-6 w-6 text-indigo-600"}),$.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Training Examples Library"})]}),$.jsxs("div",{className:"flex items-center gap-2",children:[$.jsxs("button",{onClick:()=>f(!y),className:"flex items-center gap-1 px-3 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm",children:[$.jsx(i,{className:"h-4 w-4"}),"Add Example"]}),$.jsxs("button",{onClick:I,disabled:0===t.length,className:"flex items-center gap-1 px-3 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm disabled:opacity-50",children:[$.jsx(r,{className:"h-4 w-4"}),"Export"]}),$.jsxs("label",{className:"flex items-center gap-1 px-3 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm cursor-pointer",children:[$.jsx(o,{className:"h-4 w-4"}),"Import",$.jsx("input",{type:"file",accept:".json",onChange:P,className:"hidden"})]})]})]}),$.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:$.jsxs("div",{className:"flex items-start gap-3",children:[$.jsx(l,{className:"h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5"}),$.jsxs("div",{className:"text-sm text-blue-800",children:[$.jsx("p",{className:"font-medium",children:"Continuous Learning System"}),$.jsx("p",{className:"text-xs mt-1",children:"Feed completed discharge summaries (with or without consultant notes) to help the system learn. The system analyzes patterns, structure, terminology, and clinical approaches to improve future outputs. No patient identifiable information is stored - only patterns and structures are extracted."})]})]})}),v&&$.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 flex items-center gap-2",children:[$.jsx(c,{className:"h-5 w-5 text-green-600"}),$.jsx("span",{className:"text-sm text-green-800",children:v})]}),j&&$.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 flex items-center gap-2",children:[$.jsx(d,{className:"h-5 w-5 text-red-600"}),$.jsx("span",{className:"text-sm text-red-800",children:j})]}),t.length>0&&$.jsxs("div",{className:"card bg-gradient-to-br from-indigo-50 to-purple-50",children:[$.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[$.jsx(m,{className:"h-5 w-5 text-indigo-600"}),$.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Learning Statistics"})]}),$.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[$.jsxs("div",{className:"p-2 bg-white rounded",children:[$.jsx("p",{className:"text-gray-600 text-xs",children:"Total Examples"}),$.jsx("p",{className:"font-semibold text-lg",children:t.length})]}),$.jsxs("div",{className:"p-2 bg-white rounded",children:[$.jsx("p",{className:"text-gray-600 text-xs",children:"Unique Pathologies"}),$.jsx("p",{className:"font-semibold text-lg",children:new Set(t.map(e=>e.pathology).filter(Boolean)).size})]}),$.jsxs("div",{className:"p-2 bg-white rounded",children:[$.jsx("p",{className:"text-gray-600 text-xs",children:"With Consultants"}),$.jsx("p",{className:"font-semibold text-lg",children:t.filter(e=>e.consultantNotes).length})]})]})]}),y&&$.jsxs("div",{className:"card bg-gray-50 border-2 border-indigo-300",children:[$.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Add Training Example"}),$.jsxs("div",{className:"space-y-3",children:[$.jsxs("div",{children:[$.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pathology/Diagnosis Category"}),$.jsx("input",{type:"text",value:h.pathology,onChange:e=>x({...h,pathology:e.target.value}),placeholder:"e.g., Brain Tumor, Spine Fracture, SAH, TBI",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500"})]}),$.jsxs("div",{children:[$.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Admission Note/H&P"}),$.jsx("textarea",{value:h.admissionNote,onChange:e=>x({...h,admissionNote:e.target.value}),placeholder:"Paste admission note here...",className:"w-full h-24 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500"})]}),$.jsxs("div",{children:[$.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Progress Notes"}),$.jsx("textarea",{value:h.progressNotes,onChange:e=>x({...h,progressNotes:e.target.value}),placeholder:"Paste progress notes here...",className:"w-full h-24 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500"})]}),$.jsxs("div",{children:[$.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Consultant Notes (Optional)"}),$.jsx("textarea",{value:h.consultantNotes,onChange:e=>x({...h,consultantNotes:e.target.value}),placeholder:"Paste consultant notes here if available...",className:"w-full h-24 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500"})]}),$.jsxs("div",{children:[$.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Procedure Note (Optional)"}),$.jsx("textarea",{value:h.procedureNote,onChange:e=>x({...h,procedureNote:e.target.value}),placeholder:"Paste procedure/operative note here if available...",className:"w-full h-24 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500"})]}),$.jsxs("div",{children:[$.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Final/Discharge Note (Optional)"}),$.jsx("textarea",{value:h.finalNote,onChange:e=>x({...h,finalNote:e.target.value}),placeholder:"Paste final discharge note here if available...",className:"w-full h-24 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500"})]}),$.jsxs("div",{children:[$.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Completed Discharge Summary ",$.jsx("span",{className:"text-red-600",children:"*"})]}),$.jsx("textarea",{value:h.completedSummary,onChange:e=>x({...h,completedSummary:e.target.value}),placeholder:"Paste the completed/final discharge summary here...",className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500"})]}),$.jsxs("div",{children:[$.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (Optional)"}),$.jsx("input",{type:"text",value:h.notes,onChange:e=>x({...h,notes:e.target.value}),placeholder:"Any special notes about this case...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500"})]}),$.jsxs("div",{className:"flex gap-2",children:[$.jsx("button",{onClick:A,className:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium",children:"Add to Training Library"}),$.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 text-sm font-medium",children:"Cancel"})]})]})]}),t.length>0?$.jsxs("div",{className:"space-y-2",children:[$.jsxs("h3",{className:"text-sm font-semibold text-gray-700",children:["Training Examples (",t.length,")"]}),t.map(e=>$.jsxs("div",{className:"card bg-white border border-gray-200",children:[$.jsxs("div",{className:"flex items-start justify-between",children:[$.jsxs("div",{className:"flex-1",children:[$.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[$.jsx(u,{className:"h-4 w-4 text-indigo-600"}),$.jsx("span",{className:"font-medium text-sm text-gray-900",children:e.pathology||"Unspecified Pathology"}),e.consultantNotes&&$.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded text-xs",children:"With Consultant"})]}),$.jsxs("p",{className:"text-xs text-gray-500",children:["Added: ",new Date(e.timestamp).toLocaleDateString()]}),e.notes&&$.jsx("p",{className:"text-xs text-gray-600 mt-1",children:e.notes})]}),$.jsxs("div",{className:"flex items-center gap-1",children:[$.jsx("button",{onClick:()=>N(b===e.id?null:e.id),className:"p-1 text-gray-600 hover:text-indigo-600",title:"View details",children:$.jsx(g,{className:"h-4 w-4"})}),$.jsx("button",{onClick:()=>D(e.id),className:"p-1 text-gray-600 hover:text-red-600",title:"Delete",children:$.jsx(p,{className:"h-4 w-4"})})]})]}),b===e.id&&$.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 space-y-2 text-xs",children:[e.admissionNote&&$.jsxs("div",{children:[$.jsx("p",{className:"font-medium text-gray-700",children:"Admission Note:"}),$.jsxs("p",{className:"text-gray-600 mt-1 max-h-20 overflow-y-auto",children:[e.admissionNote.substring(0,200),"..."]})]}),e.completedSummary&&$.jsxs("div",{children:[$.jsx("p",{className:"font-medium text-gray-700",children:"Completed Summary:"}),$.jsxs("p",{className:"text-gray-600 mt-1 max-h-20 overflow-y-auto",children:[e.completedSummary.substring(0,200),"..."]})]})]})]},e.id))]}):$.jsxs("div",{className:"card bg-gray-50 border-2 border-dashed border-gray-300 text-center py-8",children:[$.jsx(n,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),$.jsx("p",{className:"text-sm text-gray-600",children:"No training examples yet"}),$.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Add your first example to start building the learning library"})]})]})},k=()=>{const[e,t]=a.useState(""),[s,n]=a.useState({admission:"",progress:"",consultant:"",procedure:"",final:""}),[i,m]=a.useState(null),[C,E]=a.useState(""),[A,D]=a.useState(""),[I,P]=a.useState("input"),[T,O]=a.useState(!1),[R,L]=a.useState(""),[k,M]=a.useState([]),[U,F]=a.useState(""),[H,G]=a.useState(!1),[z,V]=a.useState(!1),[K,Z]=a.useState(!1),[q,B]=a.useState(""),[J,Y]=a.useState(""),[W,X]=a.useState(""),[Q,ee]=a.useState(!1),[te,se]=a.useState(!0),[ae,ne]=a.useState("standard"),[ie,re]=a.useState(()=>{const e=localStorage.getItem("dischargeSummaryLearning");return e?JSON.parse(e):{corrections:[],patterns:{},totalEdits:0,lastUpdated:null}}),[oe,le]=a.useState(()=>{const e=localStorage.getItem("globalLearningPatterns");return e?JSON.parse(e):null}),ce=a.useRef(null),de=a.useRef(null);a.useEffect(()=>{const e=localStorage.getItem("dischargeSummaryDraft");if(e)try{const s=JSON.parse(e),a=s?.savedAt?new Date(s.savedAt).getTime():null,i=Date.now(),r=!!a&&i-a<=864e5,o=s.unifiedNotes||s.clinicalNotes||"";!o||!r&&s.savedAt||(t(o),s.detectedNotes&&n(s.detectedNotes),F("Previous draft restored"),setTimeout(()=>F(""),3e3))}catch(r){console.error("Failed to load saved draft",r)}const s=localStorage.getItem("geminiApiKey"),a=localStorage.getItem("openaiApiKey"),i=localStorage.getItem("claudeApiKey");s&&(B(s),Z(!0)),a&&Y(a),i&&X(i)},[]),a.useEffect(()=>{if(!te)return;const t=setTimeout(()=>{(e||Object.values(s).some(e=>e))&&localStorage.setItem("dischargeSummaryDraft",JSON.stringify({unifiedNotes:e,clinicalNotes:e,detectedNotes:s,savedAt:(new Date).toISOString()}))},2e3);return()=>clearTimeout(t)},[e,s,te]);const me=a.useCallback(e=>{const t={admission:"",progress:"",consultant:"",procedure:"",final:""},s=e.split(/(?:\n={3,}|\n-{3,}|\n\*{3,}|\n#{2,})/);if(1===s.length&&s[0].trim().length>100){return e.split(/\n\s*\n/).forEach(e=>{const s=e.toLowerCase();e.trim()&&(s.match(/admission|chief complaint|history of present|hpi|pmh|past medical/i)?t.admission+=e+"\n\n":s.match(/post[- ]?op|pod|hospital day|progress|daily|soap/i)?t.progress+=e+"\n\n":s.match(/consult|pt eval|ot eval|therapy|recommend/i)?t.consultant+=e+"\n\n":s.match(/operative|procedure|operation|surgery performed/i)?t.procedure+=e+"\n\n":s.match(/discharge|disposition|follow.?up|discharge meds/i)?t.final+=e+"\n\n":t.progress+=e+"\n\n")}),Object.values(t).some(e=>e.trim())||(t.progress=e),t}return s.forEach(e=>{const s=e.toLowerCase(),a=e.trim();a&&(s.includes("admission")||s.includes("history and physical")||s.includes("h&p")||s.includes("chief complaint")||s.includes("patient")&&s.includes("admitted")?t.admission+=a+"\n\n":s.includes("progress note")||s.includes("daily note")||s.includes("soap note")||s.includes("neurosurgery")&&s.includes("note")||s.match(/post[- ]?op(?:erative)?\s+day/i)?t.progress+=a+"\n\n":s.includes("consult")||s.includes("consultation")||s.includes("recommendations from")||s.match(/(?:cardiology|neurology|medicine|icu|surgery)\s+note/i)?t.consultant+=a+"\n\n":s.includes("operative note")||s.includes("procedure note")||s.includes("operation performed")||s.includes("operative report")||s.includes("op note")?t.procedure+=a+"\n\n":s.includes("discharge")||s.includes("final note")||s.includes("discharge summary")||s.includes("disposition")?t.final+=a+"\n\n":""===t.admission&&a.length>50&&(t.admission+=a+"\n\n"))}),Object.values(t).some(e=>e.trim())||(t.admission=e),t},[]),ue=a.useCallback(e=>{const t={diagnoses:[],procedures:[],medications:[],hospitalCourseEvents:[],clinicalFindings:[]};return[/\b(bleed|bleeding|hemorrhage|hematoma|ICH|intracranial hemorrhage|SDH|subdural hematoma|EDH|epidural hematoma|SAH|subarachnoid hemorrhage|IPH|intraparenchymal hemorrhage|IVH|intraventricular hemorrhage)\b/gi,/\b(tumor|neoplasm|glioma|glioblastoma|GBM|astrocytoma|oligodendroglioma|meningioma|schwannoma|acoustic neuroma|pituitary adenoma|craniopharyngioma|metastasis|metastatic|brain mass|spinal tumor)\b/gi,/\b(spinal stenosis|herniated disc|disc herniation|radiculopathy|radicular pain|myelopathy|spondylolisthesis|spondylosis|degenerative disc disease|spinal fracture|vertebral fracture|spinal cord injury|SCI)\b/gi,/\b(aneurysm|AVM|arteriovenous malformation|cavernous malformation|cavernoma|dural arteriovenous fistula|dural AVF|vasospasm|moyamoya)\b/gi,/\b(infection|abscess|brain abscess|spinal abscess|epidural abscess|meningitis|encephalitis|osteomyelitis|discitis|empyema|subdural empyema)\b/gi,/\b(CSF leak|cerebrospinal fluid leak|CSF rhinorrhea|CSF otorrhea|hydrocephalus|NPH|normal pressure hydrocephalus|obstructive hydrocephalus|communicating hydrocephalus|pseudotumor cerebri|IIH|idiopathic intracranial hypertension|increased ICP|intracranial pressure)\b/gi,/\b(seizure|seizures|epilepsy|status epilepticus|convulsion|convulsions|post-traumatic epilepsy)\b/gi,/\b(stroke|CVA|cerebrovascular accident|TIA|transient ischemic attack|ischemic stroke|hemorrhagic stroke)\b/gi,/\b(traumatic brain injury|TBI|head trauma|head injury|concussion|contusion|diffuse axonal injury|DAI)\b/gi,/\b(Chiari malformation|syringomyelia|tethered cord|spinal dysraphism)\b/gi,/\b(hypertension|HTN|high blood pressure)\b/gi,/\b(diabetes|DM|diabetic)\b/gi,/\b(pneumonia|UTI|urinary tract infection|sepsis)\b/gi,/\b(MI|myocardial infarction|heart attack|CHF|heart failure)\b/gi,/\b(COPD|asthma|respiratory failure)\b/gi,/\b(renal failure|kidney disease|CKD|acute kidney injury|AKI)\b/gi,/\b(DVT|deep vein thrombosis|PE|pulmonary embolism)\b/gi].forEach(s=>{const a=e.matchAll(s);for(const n of a){const s=n[1]||n[0],a=n.index,i=e.substring(Math.max(0,a-100),a),r=e.substring(a,Math.min(e.length,a+100)),o=i+n[0]+r,l=s.trim().toLowerCase();t.diagnoses.some(e=>e.condition.toLowerCase()===l)||t.diagnoses.push({condition:s.trim(),context:o.trim()})}}),[/\b(craniotomy|craniectomy)\b/gi,/\b(clipping|coiling)\b/gi,/\b(evacuation|drainage)\b/gi,/\b(laminectomy|discectomy|fusion|decompression)\b/gi,/\b(shunt|EVD|external ventricular drain|ventriculostomy)\b/gi,/\b(biopsy|resection|excision|removal)\b/gi,/\b(embolization|angioplasty)\b/gi].forEach(s=>{const a=e.matchAll(s);for(const n of a){const s=n.index,a=Math.max(0,s-50),i=Math.min(e.length,s+(n[0]?.length||0)+200),r=e.substring(a,i).match(/\b([A-Z]?\d?[-\s]?[A-Z]?\d?\s+)?(\w+\s+)?(craniotomy|craniectomy|clipping|coiling|evacuation|drainage|laminectomy|discectomy|fusion|decompression|shunt|EVD|biopsy|resection|excision|removal|embolization)(\s+\w+)?/i);if(r){const e=r[0].trim(),s=e.trim().toLowerCase();e.length>=5&&!t.procedures.some(e=>e.toLowerCase()===s)&&!e.match(/^(progress|notes?|assessment|plan|s|the|and|or|for)$/i)&&t.procedures.push(e.trim())}}}),[/\b([A-Z][a-z]+(?:cillin|mycin|oxacin|tidine|prazole|olol|pril|sartan|statin))\s+(\d+\.?\d*)\s*(mg|mcg|g|units?)(?:\s+(daily|BID|TID|QID|q\d+h|PRN))?/gi,/\b(aspirin|acetaminophen|ibuprofen|morphine|fentanyl|hydrocodone|oxycodone)\s+(\d+\.?\d*)\s*(mg|mcg)(?:\s+(daily|BID|TID|QID|q\d+h|PRN))?/gi,/\b(levetiracetam|keppra|phenytoin|dilantin|carbamazepine|valproic acid)\s+(\d+\.?\d*)\s*(mg|mcg)(?:\s+(daily|BID|TID|QID|q\d+h|PRN))?/gi,/\b(nimodipine|labetalol|metoprolol|lisinopril|amlodipine)\s+(\d+\.?\d*)\s*(mg|mcg)(?:\s+(daily|BID|TID|QID|q\d+h|PRN))?/gi].forEach(s=>{const a=e.matchAll(s);for(const e of a)if(e[1]&&e[2]){const s=`${e[1]} ${e[2]}${e[3]||""}${e[4]?" "+e[4]:""}`,a=s.trim().toLowerCase();t.medications.some(e=>e.toLowerCase()===a)||t.medications.push(s.trim())}}),[/\b(underwent|had|received|completed|tolerated|developed|experienced)\s+([^.]+)/gi,/\b(post[-\s]?op(?:erative)?|after surgery|following procedure)\s+([^.]+)/gi,/\b(improved|worsened|stabilized|recovered|progressed)\b/gi,/\b(transferred to|admitted to|discharged to)\s+([^.]+)/gi,/\b(day \d+|POD \d+|hospital day \d+|HD \d+)\s*:?\s*([^.]+)/gi].forEach(s=>{const a=e.matchAll(s);for(const e of a){const s=e[0],a=s.trim().toLowerCase();t.hospitalCourseEvents.some(e=>e.toLowerCase()===a)||t.hospitalCourseEvents.push(s.trim())}}),t},[]),ge=a.useCallback((e=null)=>{const t=e||s,a=t.admission||"",n=t.progress||"",i=t.final||"",r=t.procedure||"",o=ue(a+" "+n+" "+i+" "+r),l=[/(\d{1,3})[\s-]*(?:year|years|yo|y\.o\.|y\/o)[\s-]*old/i,/(?:Age|AGE)\s*:?\s*(\d{1,3})/i,/(?:is\s+a\s+|is\s+an\s+)(\d{1,3})[\s-]*(?:year|yo)/i],c=[/\b(male|female|man|woman|M|F)\b/i,/(?:Sex|Gender|SEX|GENDER)\s*:?\s*(male|female|M|F)/i],d=[/(?:MRN|Medical Record Number|MR#|Medical Record)\s*:?\s*(\d+)/i,/(?:Record|Chart)\s*(?:#|Number)?\s*:?\s*(\d+)/i],m=[/(?:Admission Date|Date of Admission|Admitted|DOA)\s*:?\s*(\d{1,2}[/-]\d{1,2}[/-]\d{2,4})/i,/(?:Admitted on|Admission on)\s*:?\s*(\d{1,2}[/-]\d{1,2}[/-]\d{2,4})/i],u=[/(?:Discharge Date|Date of Discharge|DOD|Discharged)\s*:?\s*(\d{1,2}[/-]\d{1,2}[/-]\d{2,4})/i,/(?:Discharged on|Discharge on)\s*:?\s*(\d{1,2}[/-]\d{1,2}[/-]\d{2,4})/i],g=(e,t)=>{for(const s of t){const t=e.match(s);if(t&&t[1])return t[1].trim()}return""},p={patientName:g(a,[/(?:Patient Name|Patient|Name|Mr\.|Mrs\.|Ms\.|Dr\.)\s*:?\s*([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)/,/^([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+is\s+a\s+\d+/m,/([A-Z][a-z]+(?:\s+[A-Z][a-z]+){1,3}),?\s+(?:a\s+)?\d{1,3}[\s-]*(?:year|yo)/]),age:g(a,l),sex:g(a,c),mrn:g(a,d),admitDate:g(a,m),dischargeDate:g(i,u),admittingDiagnosis:"",dischargeDiagnosis:"",procedures:[],historyPresenting:"",hospitalCourse:"",complications:[],imaging:[],consultantRecommendations:[],postOpProgress:"",majorEvents:[],currentExam:"",dischargeExam:"",neurologicalExam:"",vitalSigns:"",kps:"",dischargeConditionScore:"",functionalStatus:"",dischargeMedications:[],allergies:"",pmh:[],psh:[],disposition:"Home",diet:"Regular",activity:"As tolerated",followUp:[]},h=a+"\n"+n+"\n"+i;let x=a.match(/(?:Admitting Diagnosis|Primary Diagnosis)\s*:?\s*([^\n]{1,200}?)(?=\n|$)/i);if(!x&&(x=a.match(/(?:Chief Complaint|CC|Presenting Problem)\s*:?\s*([^\n]{1,150}?)(?=\n|$)/i),x&&x[1])){const e=x[1].trim();(e.match(/\b(he|she|patient|denies|reports|states|presents with|led to|his|her)\b/i)||e.length>100||e.split(/[.!?]/).length>2)&&(x=null)}x||(x=a.match(/^Diagnosis\s*:?\s*([^\n]{1,150}?)(?=\n|$)/im)),!x&&o.diagnoses.length>0?p.admittingDiagnosis=o.diagnoses[0].condition:x&&(p.admittingDiagnosis=x[1].trim());let y=i.match(/(?:Discharge Diagnosis|Final Diagnosis|Primary Diagnosis)\s*:?\s*([^\n]+)/i);if(y||(y=h.match(/(?:Discharge Diagnosis|Final Diagnosis|Primary Diagnosis)\s*:?\s*([^\n]+)/i)),y||(y=h.match(/^Diagnosis\s*:?\s*([^\n]+)/im)),!y&&o.diagnoses.length>0){const e=o.diagnoses.slice(0,3).map(e=>e.condition).join(", ");p.dischargeDiagnosis=e}else y&&(p.dischargeDiagnosis=y[1].trim());const f=a.match(/(?:HPI|History of Present Illness|History|Present Illness|Chief Complaint|CC)\s*:?\s*([\s\S]{50,800}?)(?=\n\n+|\n(?:PMH|Past Medical|PSH|Past Surgical|Medications|Allergies|Physical Exam|PE|Assessment|Plan)\s*:|$)/i);f&&(p.historyPresenting=f[1].trim());const b=a.match(/(?:PMH|Past Medical History|Medical History)\s*:?\s*([\s\S]{20,500}?)(?=\n\n+|\n(?:PSH|Past Surgical|Medications|Allergies|Social History|Family History)\s*:|$)/i);b&&(p.pmh=b[1].split(/[,\n]/).filter(e=>e.trim()).map(e=>e.trim()));const N=a.match(/(?:Allergies|ALLERGIES|Allergy|NKDA)\s*:?\s*([^\n]+)/i);N&&(p.allergies=N[1].trim());const v=r||n;if(v){let e=v.match(/(?:Procedure|Operation|Surgery|Operative Procedure)(?!\(s\)\s*\([A-Z]+\)\s*:)\s*:?\s*([^\n]{15,})/gi);const t=v.matchAll(/(?:Post-?Op(?:erative)?\s+)?(?:Procedure|Operation|Surgery)\s*(?:\(s\))?\s*(?:\([A-Z]+\))?\s*:\s*\n([^\n]{15,})/gi),s=[...e||[],...Array.from(t).map(e=>e[1]).map(e=>`Procedure: ${e}`)];s.length>0&&(p.procedures=s.map(e=>e.replace(/(?:Post-?Op(?:erative)?\s+)?(?:Procedure|Operation|Surgery|Operative Procedure)\s*(?:\(s\))?\s*(?:\([A-Z]+\))?\s*:?\s*/i,"").trim()).filter(e=>{const t=e.length>=15,s=!e.match(/^[\(\)\s\w]{1,5}$/),a=!e.match(/^(progress|notes?|s|LRB|RRB|\(s\)|\([A-Z]+\)|assessment|plan|in bed|received|see below|as follows)$/i),n=/\b\w{3,}\b.*\b\w{3,}\b/.test(e),i=e.match(/\b(craniotomy|craniectomy|laminectomy|discectomy|fusion|biopsy|resection|excision|removal|drainage|evacuation|decompression|clipping|coiling|shunt|evd|minicraniotomy|duraplasty)\b/i);return t&&s&&a&&n&&i}));const a=n.match(/(?:POD|Post-op day|Hospital Day|HD)\s*#?\d+[^\n]*\n([\s\S]{50,500}?)(?=\n(?:POD|Post-op|Hospital Day|HD)|$)/gi);a&&(p.hospitalCourse=a.join("\n\n"))}if(0===p.procedures.length&&o.procedures.length>0){const e=o.procedures.filter(e=>e.length>=5&&!e.match(/^(progress|notes?|s|assessment|plan)$/i));e.length>0&&(p.procedures=e)}if(!p.hospitalCourse){const e=(a+"\n"+n+"\n"+i).match(/(?:Hospital Course|Clinical Course|Course)\s*:?\s*([\s\S]{30,1000}?)(?=\n\n(?:[A-Z][a-z]+\s*:)|Discharge|Physical Exam|Medications|Disposition|$)/i);e&&(p.hospitalCourse=e[1].trim())}!p.hospitalCourse&&o.hospitalCourseEvents.length>0&&(p.hospitalCourse=o.hospitalCourseEvents.slice(0,10).join(". ")+".");const S=i.match(/(?:Physical Exam|PE|Examination|Exam)\s*:?\s*([\s\S]{30,400}?)(?=\n\n|\n[A-Z]|Labs|Medications|$)/i);S&&(p.currentExam=S[1].trim());const j=i.match(/(?:Vital Signs|Vitals|VS)\s*:?\s*([^\n]+)/i);j&&(p.vitalSigns=j[1].trim());const w=i.match(/(?:Discharge Medications|Medications|Meds)\s*:?\s*([\s\S]{30,500}?)(?=\n\n|\nFollow|Activity|Diet|$)/i);w&&(p.dischargeMedications=w[1].split(/\n/).filter(e=>e.trim()&&/\d/.test(e)).map(e=>e.trim())),0===p.dischargeMedications.length&&o.medications.length>0&&(p.dischargeMedications=o.medications);const C=i.match(/(?:Disposition|Discharge to|Going to)\s*:?\s*([^\n]+)/i);C&&(p.disposition=C[1].trim());const E=i.match(/(?:Follow.?up|F\/U|Appointments)\s*:?\s*([\s\S]{20,300}?)(?=\n\n|Warning|Instructions|$)/i);E&&(p.followUp=E[1].split(/\n/).filter(e=>e.trim()).map(e=>e.trim()));const A=h.match(/(?:CT|MRI|X-ray|Imaging|Radiology)\s*(?:scan|report|findings|shows?|demonstrates?|reveals?)\s*:?\s*([\s\S]{30,500}?)(?=\n\n|\n(?:Labs?|Physical|Exam|Assessment|Plan)|$)/gi);A&&(p.imaging=A.map(e=>e.replace(/(?:CT|MRI|X-ray|Imaging|Radiology)\s*(?:scan|report|findings|shows?|demonstrates?|reveals?)\s*:?\s*/i,"").trim()));const D=h.match(/(?:Complications?|Adverse Events?|Post-?op complications?)\s*:?\s*([\s\S]{20,400}?)(?=\n\n|\n[A-Z][a-z]+\s*:|$)/i);if(D)p.complications=D[1].split(/[,;\n]/).filter(e=>e.trim()&&e.length>3).map(e=>e.trim());else{const e=n.match(/\b(developed|experienced|had)\s+([\w\s]+(?:hemorrhage|infection|leak|dehiscence|failure|arrest|sepsis|pneumonia|DVT|PE|MI|stroke))/gi);e&&(p.complications=e.map(e=>e.replace(/\b(developed|experienced|had)\s+/i,"").trim()))}const I=(t.consultant||"").match(/(?:Recommendations?|Plan|Suggest|Advise)\s*:?\s*([\s\S]{30,500}?)(?=\n\n|\n(?:Signed|Attending)|$)/i);if(I)p.consultantRecommendations=I[1].split(/\n/).filter(e=>e.trim()&&e.length>5).map(e=>e.trim());else{const e=h.match(/(?:Consult(?:ant|ation)?|Specialist|Physical Therapy|PT eval(?:uation)?|Occupational Therapy|OT eval(?:uation)?|Cardiology|Neurology|Rehab|Pain|Speech)\s+(?:recommend(?:s|ed)?|suggest(?:s|ed)?|advise(?:s|d)?|state(?:s|d)?|note(?:s|d)?|eval(?:uated|uation)?)\s*:?\s*([^\n]{20,300})/gi);e&&(p.consultantRecommendations=e.map(e=>e.trim()));const t=h.match(/(?:PT|OT|Physical Therapy|Occupational Therapy)\s*(?:Notes?|Evaluation|Assessment|Recommendations?)\s*:?\s*([\s\S]{30,300}?)(?=\n\n|\n[A-Z][a-z]+\s*:|$)/gi);t&&t.forEach(e=>{const t=e.trim();p.consultantRecommendations.some(e=>e.toLowerCase().includes(t.toLowerCase().substring(0,20)))||p.consultantRecommendations.push(t)})}const P=n.match(/(?:POD|Post-?op(?:erative)? day|Hospital day|HD)\s*#?\s*(\d+)\s*:?\s*([\s\S]{30,500}?)(?=\n(?:POD|Post-?op|Hospital day|HD|Date:|\d{1,2}\/\d{1,2})|\n\n|$)/gi);P&&(p.postOpProgress=P.join("\n\n"));[/\b(code blue|rapid response|ICU transfer|intubat(?:ed|ion)|extubat(?:ed|ion)|cardiac arrest|seizure|stroke|hemorrhage|reoperation)\b/gi,/\b(transferred to ICU|admitted to ICU|return to OR|emergency surgery)\b/gi].forEach(e=>{const t=h.matchAll(e);for(const s of t){const e=s.index,t=h.substring(Math.max(0,e-50),e),a=h.substring(e,Math.min(h.length,e+100)),n=(t+s[0]+a).trim();p.majorEvents.some(e=>e.toLowerCase().includes(s[0].toLowerCase()))||p.majorEvents.push(n)}});const T=i.match(/(?:Discharge Exam|Physical Exam(?:ination)? at Discharge|Final Exam)\s*:?\s*([\s\S]{30,500}?)(?=\n\n|\n(?:Labs?|Medications|Disposition)|$)/i);T?p.dischargeExam=T[1].trim():p.currentExam&&(p.dischargeExam=p.currentExam);const O=h.match(/(?:Neuro(?:logical)? Exam|Mental Status|CN|Cranial Nerves|Motor|Sensory)\s*:?\s*([\s\S]{30,400}?)(?=\n\n|\n(?:Cardiovascular|Respiratory|Labs)|$)/i);O&&(p.neurologicalExam=O[1].trim());const $=h.match(/(?:KPS|Karnofsky Performance Status|Karnofsky)\s*:?\s*(\d{1,3})/i);$&&(p.kps=$[1]);if(!p.kps&&(p.neurologicalExam||p.dischargeExam||p.currentExam)){const e=(()=>{const e=(p.neurologicalExam+" "+p.dischargeExam+" "+p.currentExam+" "+h).toLowerCase();let t=0,s="";e.includes("independent")||e.includes("ambulat")&&e.includes("independent")?e.includes("normal")||e.includes("no deficits")||e.includes("intact")?(t=90,s="Independent with normal activity; no or minor signs/symptoms of disease"):(t=80,s="Independent with activities of daily living; some signs/symptoms of disease"):e.includes("minimal assistance")||e.includes("contact guard")?(t=70,s="Cares for self; unable to carry on normal activity or work; minimal assistance required"):e.includes("moderate assistance")||e.includes("assist")&&!e.includes("independent")?(t=60,s="Requires occasional assistance but able to care for most needs; moderate assistance required"):e.includes("maximal assistance")||e.includes("dependent")?(t=50,s="Requires considerable assistance and frequent care; considerable/maximal assistance required"):(e.includes("total care")||e.includes("unable to care"))&&(t=40,s="Disabled; requires special care and assistance; total care required"),e.includes("bedridden")||e.includes("bed-bound")?(t=Math.min(t,30),s="Severely disabled; hospitalization/skilled care indicated; bedridden"):e.includes("wheelchair")&&(t=Math.max(40,Math.min(t,60))),(e.includes("fully functional")||e.includes("no limitations"))&&(t=100,s="Normal; no complaints; no evidence of disease"),e.match(/motor.*5\/5|strength.*5\/5|full strength/i)?t=Math.max(t,80):e.match(/motor.*[3-4]\/5|strength.*[3-4]\/5/i)?t=Math.max(40,Math.min(t,70)):e.match(/motor.*[1-2]\/5|strength.*[1-2]\/5/i)&&(t=Math.min(t,50));let a="";return t>=80?a="5 - Excellent":t>=70?a="4 - Good":t>=50?a="3 - Fair":t>=30?a="2 - Poor":t>0&&(a="1 - Critical"),{kpsScore:t,functionalDescription:s,dcsScore:a}})();e.kpsScore>0&&(p.kps=e.kpsScore.toString(),p.functionalStatus=e.functionalDescription,p.dischargeConditionScore=e.dcsScore)}return p},[s,ue]),pe=a.useCallback(async()=>{if(!q)throw new Error("Gemini API key is required");const e=s,t=`You are a medical AI specialized in extracting neurosurgical and spine patient information. \nExtract the following information from these clinical notes and return as JSON:\n- patientName, age, sex, mrn\n- admitDate, dischargeDate\n- admittingDiagnosis, dischargeDiagnosis\n- procedures (array), complications (array)\n- historyPresenting, hospitalCourse\n- imaging (array - CT/MRI/X-ray findings)\n- consultantRecommendations (array - recommendations from consultants)\n- postOpProgress (string - post-operative day-by-day progress)\n- majorEvents (array - significant events during hospitalization)\n- currentExam, dischargeExam, neurologicalExam, vitalSigns\n- dischargeMedications (array), allergies\n- pmh (array), psh (array)\n- disposition, diet, activity\n- followUp (array)\n- kps (Karnofsky Performance Status score if mentioned)\n- functionalStatus (overall functional assessment)\n\nFocus on: reason for admission, signs/symptoms, imaging findings, surgical treatments, post-operative progress, \nsymptom changes (new/worsening/improving), major events, consultant plans.\n\nFor neurosurgery cases, pay special attention to: hemorrhage/bleed, tumor, infection, abscess, CSF leak, \nhydrocephalus, radicular pain, myelopathy, fracture, seizures.\n\nEstimate functional status from physical exam findings (independence, mobility, motor strength).\n\nADMISSION NOTE:\n${e.admission}\n\nPROGRESS NOTES:\n${e.progress}\n\nCONSULTANT NOTES:\n${e.consultant}\n\nPROCEDURE NOTE:\n${e.procedure}\n\nDISCHARGE NOTE:\n${e.final}`;try{const e=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${q}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:t}]}],generationConfig:{temperature:.1,maxOutputTokens:2048}})});if(!e.ok)throw new Error("Gemini API request failed");const s=await e.json(),a=s.candidates?.[0]?.content?.parts?.[0]?.text;if(a){const e=a.match(/\{[\s\S]*\}/);if(e)return JSON.parse(e[0])}throw new Error("Could not parse Gemini response")}catch(a){throw console.error("Gemini extraction error:",a),a}},[q,s]),he=a.useCallback(async e=>{if(!J)return e;try{const t=`Given this extracted patient data, synthesize and enhance the clinical narrative, \nensuring medical accuracy and completeness. Focus on neurosurgical context.\n\nExtracted Data:\n${JSON.stringify(e,null,2)}\n\nReturn enhanced data in the same JSON structure with improved narratives.`,s=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${J}`},body:JSON.stringify({model:"gpt-4",messages:[{role:"system",content:"You are a neurosurgery medical AI assistant specializing in clinical documentation."},{role:"user",content:t}],temperature:.3,max_tokens:2e3})});if(!s.ok)return console.warn("OpenAI synthesis skipped:",s.statusText),e;const a=await s.json(),n=a.choices?.[0]?.message?.content;if(n){const e=n.match(/\{[\s\S]*\}/);if(e)return JSON.parse(e[0])}return e}catch(t){return console.error("OpenAI synthesis error:",t),e}},[J]),xe=a.useCallback(async e=>{if(!W)return e;try{const t=`You are Claude, an AI specialized in medical documentation structure and summarization.\n      \nGiven this clinical data, structure and summarize it into a well-organized discharge summary format.\nFocus on clarity, completeness, and proper medical documentation standards.\n\nClinical Data:\n${JSON.stringify(e,null,2)}\n\nReturn the structured data in the same JSON format with improved organization and concise summaries.`,s=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":W,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:"claude-3-sonnet-20240229",max_tokens:2e3,messages:[{role:"user",content:t}],temperature:.3})});if(!s.ok)return console.warn("Claude structuring skipped:",s.statusText),e;const a=await s.json(),n=a.content?.[0]?.text;if(n){const e=n.match(/\{[\s\S]*\}/);if(e)return JSON.parse(e[0])}return e}catch(t){return console.error("Claude structuring error:",t),e}},[W]),ye=a.useCallback(async()=>{let e;if(q)try{e=await pe()}catch(t){console.warn("Gemini extraction failed, using patterns:",t),e=ge()}else e=ge();if(J&&e)try{e=await he(e)}catch(t){console.warn("OpenAI synthesis failed, continuing without:",t)}if(W&&e)try{e=await xe(e)}catch(t){console.warn("Claude structuring failed, continuing without:",t)}return e},[q,J,W,pe,he,xe,ge]),fe=a.useCallback((e,t)=>{const s=[];e.length<t.length?s.push({type:"addition",context:"content_expansion"}):e.length>t.length&&s.push({type:"reduction",context:"content_simplification"});const a=e.split(/\n[A-Z][A-Z\s]+\n/),n=t.split(/\n[A-Z][A-Z\s]+\n/);a.length!==n.length&&s.push({type:"structure",context:"section_reorganization"});const i={patient:["pt","individual","case"],underwent:["had","received","completed"],discharge:["released","sent home","transferred"],stable:["improving","well","good condition"],tolerated:["did well with","handled","managed"],procedure:["surgery","operation","intervention"],examination:["exam","assessment","evaluation"]};for(const[r,o]of Object.entries(i))e.toLowerCase().includes(r)&&!t.toLowerCase().includes(r)&&o.some(e=>t.toLowerCase().includes(e))&&s.push({type:"terminology_preference",from:r,to:o.find(e=>t.toLowerCase().includes(e)),context:"formality_adjustment"});(e.match(/\n/g)||[]).length<(t.match(/\n/g)||[]).length&&s.push({type:"formatting",context:"improved_readability"});return["INITIAL PRESENTATION","TREATMENT","EVOLUTION","FUNCTIONAL STATUS","REHABILITATION","CONSULTANT","DISCHARGE STATUS","HOSPITAL COURSE"].forEach(a=>{!e.includes(a)&&t.includes(a)&&s.push({type:"section_added",context:a})}),t.includes("Initial Imaging")&&!e.includes("Initial Imaging")&&s.push({type:"organization",context:"imaging_separated"}),t.includes("Pre-Operative")&&!e.includes("Pre-Operative")&&s.push({type:"organization",context:"pre_post_op_distinction"}),s},[]),be=a.useCallback(e=>{const t=fe(C,e);if(t.length>0){const e={...ie};t.forEach(t=>{const s=`${t.type}_${t.context}`;e.patterns[s]=(e.patterns[s]||0)+1}),e.corrections.push({timestamp:(new Date).toISOString(),patterns:t,editType:t.map(e=>e.type).join(",")}),e.totalEdits+=1,e.lastUpdated=(new Date).toISOString(),e.corrections.length>100&&(e.corrections=e.corrections.slice(-100)),re(e),localStorage.setItem("dischargeSummaryLearning",JSON.stringify(e)),F("Learning saved - future summaries will incorporate this pattern"),setTimeout(()=>F(""),3e3)}E(e),D(e),V(!1)},[C,ie,fe]),Ne=a.useCallback(e=>{let t=e;return Object.entries(ie.patterns).sort((e,t)=>t[1]-e[1]).slice(0,10).forEach(([e,s])=>{if(s>=2){const[s,a]=e.split("_");if("formatting"===s&&"improved"===a&&(t=t.replace(/\n([A-Z])/g,"\n\n$1")),"terminology_preference"===s){ie.corrections.filter(e=>e.patterns&&e.patterns.some(e=>"terminology_preference"===e.type)).slice(-5).forEach(e=>{e.patterns.forEach(e=>{if("terminology_preference"===e.type&&e.from&&e.to){const s=new RegExp(`\\b${e.from}\\b`,"gi");t=t.replace(s,e.to)}})})}}}),oe&&(oe.preferredTerminology&&Object.entries(oe.preferredTerminology).forEach(([e,t])=>{t.count>=3&&t.totalFreq}),oe.formattingPreferences&&(oe.formattingPreferences.bullet_list_preferred,oe.formattingPreferences.numbered_list_used)),t},[ie,oe]),ve=(e,t)=>{m(s=>({...s,[e]:t}))};return $.jsxs("div",{className:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8",children:[$.jsx("header",{className:"card mb-6 no-print",children:$.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[$.jsxs("div",{className:"flex items-center space-x-3",children:[$.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:$.jsx(h,{className:"h-8 w-8 text-blue-600"})}),$.jsxs("div",{children:[$.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Discharge Summary Generator"}),$.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Extract and generate medical discharge summaries"})]})]}),$.jsxs("div",{className:"flex items-center gap-2",children:[te&&$.jsxs("span",{className:"text-xs text-green-600 flex items-center",children:[$.jsx(x,{className:"h-3 w-3 mr-1"}),"Auto-save on"]}),$.jsx("button",{onClick:()=>se(!te),className:"btn-secondary text-sm",title:"Toggle auto-save",children:$.jsx(u,{className:"h-4 w-4"})}),$.jsx("button",{onClick:()=>{confirm("Clear all data? This cannot be undone.")&&(t(""),n({admission:"",progress:"",consultant:"",procedure:"",final:""}),m(null),E(""),D(""),L(""),M([]),F("All data cleared"),localStorage.removeItem("dischargeSummaryDraft"))},className:"btn-secondary text-sm text-red-600",title:"Clear all data",children:$.jsx(p,{className:"h-4 w-4"})})]})]})}),R&&$.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2 no-print",children:[$.jsx(d,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),$.jsx("p",{className:"text-sm text-red-800",children:R})]}),k.length>0&&$.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg no-print",children:$.jsxs("div",{className:"flex items-start gap-2",children:[$.jsx(d,{className:"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5"}),$.jsxs("div",{className:"text-sm text-yellow-800",children:[$.jsx("p",{className:"font-medium mb-1",children:"Warnings:"}),$.jsx("ul",{className:"list-disc list-inside space-y-1",children:k.map((e,t)=>$.jsx("li",{children:e},t))})]})]})}),U&&$.jsxs("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg flex items-start gap-2 no-print animate-fade-in",children:[$.jsx(c,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),$.jsx("p",{className:"text-sm text-green-800",children:U})]}),$.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[$.jsxs("div",{className:"space-y-6 no-print",children:[$.jsxs("div",{className:"card",children:[$.jsxs("div",{className:"flex items-center justify-between mb-4",children:[$.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Settings"}),$.jsx(y,{className:"h-5 w-5 text-gray-400"})]}),$.jsxs("div",{className:"space-y-3",children:[$.jsxs("div",{className:"flex items-center justify-between",children:[$.jsxs("label",{className:"flex items-center gap-2",children:[$.jsx("input",{type:"checkbox",checked:K,onChange:e=>{Z(e.target.checked),!e.target.checked||q||J||W||ee(!0)},className:"rounded"}),$.jsx("span",{className:"text-sm font-medium",children:"Use Multi-AI Extraction"}),$.jsx(l,{className:"h-4 w-4 text-purple-600"})]}),K&&$.jsx("button",{onClick:()=>ee(!Q),className:"text-xs text-blue-600 hover:underline",children:q||J||W?"Manage API Keys":"Add API Keys"})]}),Q&&$.jsxs("div",{className:"space-y-2 p-3 bg-gray-50 rounded-lg",children:[$.jsx("p",{className:"text-xs text-gray-600 mb-2",children:"Configure AI APIs for synergistic extraction:"}),$.jsxs("div",{children:[$.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Gemini API Key (Medical Extraction)"}),$.jsx("input",{type:"password",value:q,onChange:e=>B(e.target.value),placeholder:"Enter Gemini API key",className:"input-field text-sm w-full"})]}),$.jsxs("div",{children:[$.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"OpenAI API Key (Clinical Synthesis) - Optional"}),$.jsx("input",{type:"password",value:J,onChange:e=>Y(e.target.value),placeholder:"Enter OpenAI API key (optional)",className:"input-field text-sm w-full"})]}),$.jsxs("div",{children:[$.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Claude API Key (Structuring) - Optional"}),$.jsx("input",{type:"password",value:W,onChange:e=>X(e.target.value),placeholder:"Enter Claude API key (optional)",className:"input-field text-sm w-full"})]}),$.jsx("button",{onClick:()=>{q&&localStorage.setItem("geminiApiKey",q),J&&localStorage.setItem("openaiApiKey",J),W&&localStorage.setItem("claudeApiKey",W),(q||J||W)&&(Z(!0),ee(!1),F("API keys saved"))},className:"btn-primary text-sm w-full mt-2",children:"Save API Keys"})]}),$.jsxs("div",{children:[$.jsx("label",{htmlFor:"template-select",className:"block text-sm font-medium mb-1",children:"Template"}),$.jsxs("select",{id:"template-select",value:ae,onChange:e=>ne(e.target.value),className:"input-field text-sm",children:[$.jsx("option",{value:"standard",children:"Standard"}),$.jsx("option",{value:"detailed",children:"Detailed"}),$.jsx("option",{value:"brief",children:"Brief"})]})]})]})]}),$.jsxs("div",{className:"card",children:[$.jsxs("div",{className:"mb-4",children:[$.jsxs("div",{className:"flex items-center justify-between",children:[$.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Clinical Notes"}),$.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[$.jsx(f,{className:"h-4 w-4"}),$.jsx("span",{children:"Paste all notes - system will auto-detect types"})]})]}),$.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Paste admission notes, progress notes, consultant notes, procedure notes, and discharge notes. The system will automatically detect and separate different note types."})]}),Object.entries(s).some(([e,t])=>t.trim())&&$.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[$.jsx("p",{className:"text-xs font-medium text-blue-900 mb-2",children:"Detected Note Types:"}),$.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(s).filter(([e,t])=>t.trim()).map(([e,t])=>$.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-medium capitalize",children:e},e))})]}),$.jsxs("div",{className:"relative",children:[$.jsx("textarea",{value:e,onChange:e=>t(e.target.value),placeholder:"Paste all clinical notes here (admission, progress, consultations, procedures, discharge notes)...\n\nExample format (optional delimiters):\n===================================\nADMISSION NOTE / H&P\nPatient: John Doe...\n===================================\nPROGRESS NOTE - POD 1\nPatient doing well...\n===================================\nDISCHARGE NOTE\nPatient ready for discharge...",className:"input-field h-80 font-mono text-sm resize-y"}),$.jsxs("label",{className:"absolute top-3 right-3 cursor-pointer",children:[$.jsx("div",{className:"p-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:$.jsx(o,{className:"h-4 w-4 text-gray-600"})}),$.jsx("input",{ref:ce,type:"file",className:"hidden",accept:".txt,.md",onChange:e=>((e,t)=>{const s=e.target.files[0];if(!s)return;const a=new FileReader;a.onload=e=>{t(e.target.result),F(`File uploaded: ${s.name}`)},a.onerror=()=>{L("Failed to read file")},a.readAsText(s)})(e,t)})]})]}),$.jsxs("div",{className:"mt-4 flex items-center gap-2 text-xs text-gray-600",children:[$.jsx(b,{className:"h-4 w-4"}),$.jsxs("span",{children:["Character count: ",e.length]})]}),$.jsx("div",{className:"mt-4",children:$.jsx("button",{onClick:async()=>{if(e.trim()){O(!0),L(""),M([]),F("");try{const s=me(e);n(s);const a=Object.entries(s).filter(([e,t])=>t.trim()).map(([e,t])=>e);let i;if(a.length>0&&F(`Detected notes: ${a.join(", ")}`),K&&(q||J||W))try{i=await ye(),F("Multi-AI extraction completed successfully")}catch(t){console.warn("AI extraction failed, falling back to patterns:",t),i=ge(s),M(["AI extraction failed, used pattern matching instead"])}else i=ge(s),F("Pattern extraction completed");const r=[];i.patientName||r.push("Patient name not found"),i.dischargeDiagnosis||r.push("Discharge diagnosis not found"),i.dischargeMedications?.length||r.push("No discharge medications found"),r.length>0&&M(e=>[...e,...r]),m(i),P("review")}catch(s){L(`Extraction failed: ${s.message}`)}finally{O(!1)}}else L("Please enter clinical notes")},disabled:T||!e.trim(),className:"w-full btn-primary",children:T?$.jsxs($.Fragment,{children:[$.jsx(N,{className:"h-5 w-5 animate-spin"}),$.jsx("span",{children:"Detecting notes and extracting..."})]}):$.jsxs($.Fragment,{children:[K?$.jsx(l,{className:"h-5 w-5"}):$.jsx(v,{className:"h-5 w-5"}),$.jsx("span",{children:"Auto-Detect & Extract Information"})]})})})]}),i&&$.jsxs("div",{className:"card",children:[$.jsxs("div",{className:"flex items-center justify-between mb-4",children:[$.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Extracted Data"}),$.jsx(S,{className:"h-5 w-5 text-gray-400"})]}),$.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:Object.entries(i).map(([e,t])=>{const s=Array.isArray(t),a=s?t.join("\n"):t||"";return $.jsxs("div",{children:[$.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase())}),s?$.jsx("textarea",{value:a,onChange:t=>ve(e,t.target.value.split("\n").filter(Boolean)),rows:Math.min(3,t.length||1),className:"input-field text-sm font-mono"}):$.jsx("input",{type:"text",value:a,onChange:t=>ve(e,t.target.value),className:"input-field text-sm"})]},e)})}),$.jsxs("button",{onClick:()=>{if(!i)return void L("Please extract data first");const e=(e,t=!1)=>e&&0!==e.length?e.map((e,s)=>`${t?`${s+1}.`:"â€¢"} ${e}`).join("\n"):"None",t={standard:()=>`DISCHARGE SUMMARY\n================================================================================\nDate: ${(new Date).toLocaleDateString()}\n\nPATIENT INFORMATION\nName: ${i.patientName||"[Name]"}\nAge/Sex: ${i.age||"[Age]"} / ${i.sex||"[Sex]"}\nMRN: ${i.mrn||"[MRN]"}\nAdmission Date: ${i.admitDate||"[Admit Date]"}\nDischarge Date: ${i.dischargeDate||"[Discharge Date]"}\n\nDIAGNOSES\nAdmitting Diagnosis: ${i.admittingDiagnosis||"[Admitting Dx]"}\nDischarge Diagnosis: ${i.dischargeDiagnosis||"[Discharge Dx]"}\n\nINITIAL PRESENTATION\nSigns and Symptoms:\n${i.historyPresenting||"[Initial presenting signs and symptoms on admission]"}\n\nInitial Imaging Studies:\n${i.imaging&&i.imaging.length>0?i.imaging.slice(0,2).map((e,t)=>`${t+1}. ${e}`).join("\n"):"[Initial CT/MRI/X-ray findings on presentation]"}\n\nPre-Operative Clinical Examination:\n${i.currentExam||i.neurologicalExam||"[Pre-operative neurological and physical examination findings]"}\n\nTREATMENT AND INTERVENTIONS\nSurgery/Procedure Performed:\n${i.procedures&&i.procedures.length>0?i.procedures.map((e,t)=>`${t+1}. ${e}${i.admitDate?` (Date: ${i.admitDate})`:""}`).join("\n"):"[Surgery type, approach, and date]"}\n\nComplications:\n${i.complications&&i.complications.length>0?e(i.complications,!1):"None noted"}\n\nOther Treatments:\n${i.dischargeMedications&&i.dischargeMedications.length>0?`Medical management included: ${i.dischargeMedications.slice(0,3).join(", ")}`:"[Other medical treatments, interventions]"}\n\nEVOLUTION OF CLINICAL COURSE\nSigns and Symptoms Evolution:\n${i.postOpProgress||i.hospitalCourse||"[Description of how symptoms evolved throughout hospitalization]"}\n\nImaging Evolution:\n${i.imaging&&i.imaging.length>2?"Follow-up imaging:\n"+i.imaging.slice(2).map((e,t)=>`${t+1}. ${e}`).join("\n"):"[Follow-up imaging studies and changes from initial studies]"}\n\nMajor Events During Hospitalization:\n${i.majorEvents&&i.majorEvents.length>0?e(i.majorEvents,!1):"None"}\n\nPOST-OPERATIVE STATUS\nClinical Examination at Discharge:\nVital Signs: ${i.vitalSigns||"Stable"}\n\nNeurological Examination:\n${i.neurologicalExam||i.dischargeExam||"[Mental status, cranial nerves, motor, sensory, reflexes, coordination, gait]"}\n\nGeneral Physical Examination:\n${i.dischargeExam||i.currentExam||"[Cardiovascular, respiratory, abdominal, wound assessment]"}\n\nFUNCTIONAL STATUS AT DISCHARGE\n${i.kps?`Karnofsky Performance Status (KPS): ${i.kps}`:"[KPS score to be assessed]"}\n${i.dischargeConditionScore?`Discharge Condition Score: ${i.dischargeConditionScore}`:""}\n${i.functionalStatus?`Functional Assessment: ${i.functionalStatus}`:"[Functional capabilities and independence level]"}\n\nREHABILITATION SERVICES\nPhysical Therapy:\n${i.consultantRecommendations&&i.consultantRecommendations.some(e=>e.toLowerCase().includes("pt")||e.toLowerCase().includes("physical therapy"))?i.consultantRecommendations.filter(e=>e.toLowerCase().includes("pt")||e.toLowerCase().includes("physical therapy")).join("\n"):"[Physical therapy evaluation and recommendations if consulted]"}\n\nOccupational Therapy:\n${i.consultantRecommendations&&i.consultantRecommendations.some(e=>e.toLowerCase().includes("ot")||e.toLowerCase().includes("occupational therapy"))?i.consultantRecommendations.filter(e=>e.toLowerCase().includes("ot")||e.toLowerCase().includes("occupational therapy")).join("\n"):"[Occupational therapy evaluation and recommendations if consulted]"}\n\nCONSULTANT EVALUATIONS\n${i.consultantRecommendations&&i.consultantRecommendations.length>0?i.consultantRecommendations.filter(e=>!(e.toLowerCase().includes("pt")||e.toLowerCase().includes("ot")||e.toLowerCase().includes("physical therapy")||e.toLowerCase().includes("occupational therapy"))).map((e,t)=>`${t+1}. ${e}`).join("\n")||"None documented (besides PT/OT above)":"None documented"}\n\nPAST MEDICAL HISTORY\n${e(i.pmh)}\n\nPAST SURGICAL HISTORY\n${e(i.psh)}\n\nALLERGIES: ${i.allergies||"NKDA"}\n\nFINAL DISCHARGE STATUS\nClinical Status: ${i.disposition||"Improved and stable for discharge"}\nDiet: ${i.diet}\nActivity: ${i.activity}\n\nFOLLOW-UP APPOINTMENTS\n${e(i.followUp)}\n\nDISCHARGE MEDICATIONS\n${e(i.dischargeMedications,!0)}\n\nIf you have any questions or concerns, please contact your physician.\n\n_______________________________\nPhysician Signature`,detailed:()=>`COMPREHENSIVE DISCHARGE SUMMARY - NEUROSURGERY/SPINE\n================================================================================\nDate: ${(new Date).toLocaleDateString()}\n\nPATIENT INFORMATION\nName: ${i.patientName||"[Name]"}\nAge/Sex: ${i.age||"[Age]"} / ${i.sex||"[Sex]"}\nMRN: ${i.mrn||"[MRN]"}\nAdmission Date: ${i.admitDate||"[Admit Date]"}\nDischarge Date: ${i.dischargeDate||"[Discharge Date]"}\nLength of Stay: ${i.los||"[Calculate from dates]"}\n\nDIAGNOSES\nPrimary/Admitting Diagnosis: ${i.admittingDiagnosis||"[Primary diagnosis]"}\nDischarge/Final Diagnosis: ${i.dischargeDiagnosis||"[Final diagnosis with post-operative status]"}\n\nPAST MEDICAL HISTORY\n${e(i.pmh)}\n\nPAST SURGICAL HISTORY\n${e(i.psh)}\n\nALLERGIES: ${i.allergies||"NKDA"}\n\nINITIAL PRESENTATION\nChief Complaint & Presenting Signs/Symptoms:\n${i.historyPresenting||"[Detailed presenting symptoms, onset, progression, initial signs and symptoms leading to admission]"}\n\nPre-Operative Clinical Examination:\nVital Signs: ${i.vitalSigns||"[Admission vital signs]"}\n${i.neurologicalExam?`\nNeurological Examination: ${i.neurologicalExam}`:""}\n${i.currentExam?`\nGeneral Examination: ${i.currentExam}`:""}\n${i.neurologicalExam||i.currentExam?"":"[Complete pre-operative examination findings]"}\n\nInitial Imaging Studies:\n${i.imaging&&i.imaging.length>0?i.imaging.slice(0,2).map((e,t)=>`${t+1}. ${e}`).join("\n"):"[Detailed CT/MRI/X-ray findings on presentation including dates and key findings]"}\n\nTREATMENT AND INTERVENTIONS\nProcedures/Operations Performed:\n${i.procedures&&i.procedures.length>0?i.procedures.map((e,t)=>`${t+1}. ${e}${i.admitDate?` (Date: ${i.admitDate})`:""}`).join("\n"):"[Date, procedure name, surgeon, approach, operative findings, estimated blood loss, complications]"}\n\nComplications:\n${i.complications&&i.complications.length>0?i.complications.map((e,t)=>`${t+1}. ${e}`).join("\n"):"No intraoperative or postoperative complications noted."}\n\nOther Medical Treatments:\nâ€¢ Medical Management: ${i.dischargeMedications&&i.dischargeMedications.length>0?i.dischargeMedications.slice(0,3).join(", ")+(i.dischargeMedications.length>3?", and others":""):"[Medications, pain control, DVT prophylaxis]"}\nâ€¢ Symptom Management: [Pain management, nausea control, other supportive care]\n\nEVOLUTION OF CLINICAL COURSE\nHospital Course Summary:\n${i.hospitalCourse||"[Overview of hospital course from admission through discharge]"}\n\nPost-Operative Progress (Day-by-Day):\n${i.postOpProgress||"[POD #1, POD #2, etc. with daily progress notes]"}\n\nSigns and Symptoms Evolution:\n[Description of how presenting symptoms evolved - improved, resolved, or persisted]\n\nImaging Evolution:\n${i.imaging&&i.imaging.length>2?"Follow-up imaging studies:\n"+i.imaging.slice(2).map((e,t)=>`${t+1}. ${e}`).join("\n"):"[Post-operative imaging studies and comparison to pre-operative findings]"}\n\nMajor Events During Hospitalization:\n${i.majorEvents&&i.majorEvents.length>0?i.majorEvents.map((e,t)=>`${t+1}. ${e}`).join("\n"):"No major events during hospitalization."}\n\nPOST-OPERATIVE STATUS AT DISCHARGE\nClinical Examination:\nDate of Examination: ${i.dischargeDate||(new Date).toLocaleDateString()}\n\nVital Signs: ${i.vitalSigns||"T: [temp] BP: [bp] HR: [hr] RR: [rr] O2 Sat: [sat]%"}\n\nNeurological Examination:\n${i.neurologicalExam||i.dischargeExam||"â€¢ Mental Status: [Alert, oriented x3, appropriate]\nâ€¢ Cranial Nerves: [II-XII intact]\nâ€¢ Motor: [Strength 5/5 bilateral upper/lower extremities]\nâ€¢ Sensory: [Intact to light touch and pinprick]\nâ€¢ Reflexes: [DTRs 2+ and symmetric]\nâ€¢ Coordination: [Normal finger-to-nose, heel-to-shin]\nâ€¢ Gait: [Steady, independent/assisted]"}\n\n${i.dischargeExam||i.currentExam?`\nGeneral Physical Examination:\n${i.dischargeExam||i.currentExam}`:"\nGeneral Physical Examination:\nâ€¢ General: Well-appearing, no acute distress\nâ€¢ HEENT: Normocephalic, atraumatic\nâ€¢ Cardiovascular: Regular rate and rhythm\nâ€¢ Respiratory: Clear to auscultation bilaterally\nâ€¢ Abdomen: Soft, non-tender, non-distended\nâ€¢ Extremities: No edema\nâ€¢ Skin/Wound: [Surgical incision clean, dry, intact]"}\n\nFUNCTIONAL STATUS AT DISCHARGE\n${i.kps?`Karnofsky Performance Status (KPS): ${i.kps}`:"[KPS Score: To be assessed based on functional capabilities]"}\n${i.dischargeConditionScore?`\nDischarge Condition Score: ${i.dischargeConditionScore}`:"\nDischarge Condition Score: [1-Critical, 2-Poor, 3-Fair, 4-Good, 5-Excellent]"}\n${i.functionalStatus?`\nFunctional Assessment: ${i.functionalStatus}`:"\nFunctional Assessment: [Independence level, mobility, self-care abilities]"}\n\nREHABILITATION SERVICES\nPhysical Therapy Evaluation and Recommendations:\n${i.consultantRecommendations&&i.consultantRecommendations.some(e=>e.toLowerCase().includes("pt")||e.toLowerCase().includes("physical therapy"))?i.consultantRecommendations.filter(e=>e.toLowerCase().includes("pt")||e.toLowerCase().includes("physical therapy")).join("\n"):"[PT assessment of strength, mobility, transfers, gait; recommendations for ongoing therapy]"}\n\nOccupational Therapy Evaluation and Recommendations:\n${i.consultantRecommendations&&i.consultantRecommendations.some(e=>e.toLowerCase().includes("ot")||e.toLowerCase().includes("occupational therapy"))?i.consultantRecommendations.filter(e=>e.toLowerCase().includes("ot")||e.toLowerCase().includes("occupational therapy")).join("\n"):"[OT assessment of ADLs, functional cognition; recommendations for adaptive equipment/strategies]"}\n\nCONSULTANT EVALUATIONS & RECOMMENDATIONS\n${i.consultantRecommendations&&i.consultantRecommendations.length>0?i.consultantRecommendations.filter(e=>!(e.toLowerCase().includes("pt")||e.toLowerCase().includes("ot")||e.toLowerCase().includes("physical therapy")||e.toLowerCase().includes("occupational therapy"))).map((e,t)=>`${t+1}. ${e}`).join("\n")||"None documented (besides PT/OT listed above)":"No additional consultant evaluations documented or none required."}\n\nFINAL DISCHARGE STATUS\nClinical Status: ${i.disposition||"Patient improved and stable for discharge"}\nOverall Condition: [Summary of patient's status at time of discharge]\n\nDISCHARGE PLAN\n\nDisposition: ${i.disposition}\n\nActivity: ${i.activity}\n\nDiet: ${i.diet}\n\nWound Care: [Specific instructions for surgical site care]\n\nWarning Signs - Call physician or go to ER if:\nâ€¢ Severe headache or neck pain\nâ€¢ New or worsening weakness or numbness\nâ€¢ Fever > 101.5Â°F\nâ€¢ Wound drainage, redness, or swelling\nâ€¢ Loss of bowel/bladder control\nâ€¢ Severe pain not controlled by medications\nâ€¢ Any other concerning symptoms\n\nFOLLOW-UP CARE\n${e(i.followUp)}\n${i.followUp&&0!==i.followUp.length?"":"â€¢ Follow up with surgeon in 2 weeks\nâ€¢ Follow up with primary care physician in 1-2 weeks\nâ€¢ Physical therapy as arranged"}\n\nDISCHARGE MEDICATIONS\n${e(i.dischargeMedications,!0)}\n${i.dischargeMedications&&0!==i.dischargeMedications.length?"":"[Medication list with name, dose, frequency, duration, and indication]"}\n\nADDITIONAL INSTRUCTIONS\nâ€¢ Continue all medications as prescribed\nâ€¢ Attend all follow-up appointments\nâ€¢ Comply with activity restrictions\nâ€¢ Practice proper wound care\nâ€¢ Contact physician with any concerns\n\n_______________________________\nAttending Physician Signature\n\n_______________________________\nDate`,brief:()=>`DISCHARGE SUMMARY - BRIEF\n================================================================================\nPatient: ${i.patientName||"[Name]"} (${i.age||"[Age]"}/${i.sex||"[Sex]"})\nDates: ${i.admitDate||"[Admit]"} to ${i.dischargeDate||"[Discharge]"}\n\nDiagnosis: ${i.dischargeDiagnosis||"[Diagnosis]"}\nProcedures: ${i.procedures?.join(", ")||"None"}\n\nCourse: ${i.hospitalCourse||"[Brief hospital course]"}\n\nDischarge Exam: ${i.dischargeExam||i.currentExam||"Stable"}\n\nMedications:\n${e(i.dischargeMedications,!0)}\n\nFollow-up:\n${e(i.followUp)}\n\nDisposition: ${i.disposition}`};let s=(t[ae]||t.standard)();s=Ne(s),E(s),D(s),F("Summary generated successfully"),P("output")},className:"w-full btn-primary mt-4",children:[$.jsx(h,{className:"h-5 w-5"}),$.jsx("span",{children:"Generate Summary"})]})]})]}),$.jsxs("div",{className:"space-y-6",children:[$.jsxs("div",{className:"card",children:[$.jsxs("div",{className:"flex items-center justify-between mb-4 no-print",children:[$.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Generated Summary"}),C&&$.jsxs("div",{className:"flex items-center gap-2",children:[$.jsx("button",{onClick:()=>V(!z),className:"p-2 rounded-lg transition-colors "+(z?"bg-blue-100 text-blue-600":"text-gray-600 hover:bg-gray-100"),title:z?"View Mode":"Edit Mode",children:z?$.jsx(g,{className:"h-5 w-5"}):$.jsx(S,{className:"h-5 w-5"})}),$.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText(C),G(!0),F("Copied to clipboard"),setTimeout(()=>G(!1),2e3)}catch(e){L("Failed to copy to clipboard")}},className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Copy",children:H?$.jsx(c,{className:"h-5 w-5 text-green-600"}):$.jsx(j,{className:"h-5 w-5"})}),$.jsx("button",{onClick:()=>{const e=new Blob([C],{type:"text/plain"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=`discharge_summary_${(new Date).toISOString().split("T")[0]}.txt`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t),F("Summary downloaded")},className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Download",children:$.jsx(r,{className:"h-5 w-5"})}),$.jsx("button",{onClick:()=>{window.print()},className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Print",children:$.jsx(w,{className:"h-5 w-5"})})]})]}),z&&C&&$.jsx("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg no-print",children:$.jsxs("div",{className:"flex items-start gap-2",children:[$.jsx(l,{className:"h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5"}),$.jsxs("div",{className:"text-sm text-blue-800",children:[$.jsx("p",{className:"font-medium",children:"ML Learning Mode Active"}),$.jsxs("p",{className:"text-xs mt-1",children:["Your edits will be analyzed (without storing patient data) to improve future summaries. Total edits learned: ",ie.totalEdits]})]})]})}),C?$.jsx("div",{children:z?$.jsxs("div",{className:"space-y-3",children:[$.jsx("textarea",{value:A,onChange:e=>D(e.target.value),className:"w-full h-[600px] p-4 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),$.jsxs("div",{className:"flex gap-2 no-print",children:[$.jsxs("button",{onClick:()=>be(A),className:"btn-primary flex-1",children:[$.jsx(x,{className:"h-4 w-4"}),$.jsx("span",{children:"Save & Learn from Edits"})]}),$.jsx("button",{onClick:()=>{D(C),V(!1)},className:"btn-secondary",children:"Cancel"})]})]}):$.jsx("div",{ref:de,className:"bg-gray-50 rounded-lg p-4 max-h-[600px] overflow-auto",children:$.jsx("pre",{className:"whitespace-pre-wrap font-mono text-sm text-gray-800",children:C})})}):$.jsx("div",{className:"flex items-center justify-center h-96 border-2 border-dashed border-gray-300 rounded-lg",children:$.jsxs("div",{className:"text-center text-gray-400",children:[$.jsx(h,{className:"h-12 w-12 mx-auto mb-3"}),$.jsx("p",{children:"Generated summary will appear here"}),$.jsx("p",{className:"text-xs mt-2",children:"Extract data and generate summary to begin"})]})})]}),ie.totalEdits>0&&$.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-blue-50 no-print",children:[$.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[$.jsx(l,{className:"h-5 w-5 text-purple-600"}),$.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"ML Learning Statistics"})]}),$.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[$.jsxs("div",{className:"p-2 bg-white rounded",children:[$.jsx("p",{className:"text-gray-600 text-xs",children:"Total Edits"}),$.jsx("p",{className:"font-semibold text-lg",children:ie.totalEdits})]}),$.jsxs("div",{className:"p-2 bg-white rounded",children:[$.jsx("p",{className:"text-gray-600 text-xs",children:"Patterns Learned"}),$.jsx("p",{className:"font-semibold text-lg",children:Object.keys(ie.patterns).length})]})]}),ie.lastUpdated&&$.jsxs("p",{className:"text-xs text-gray-600 mt-2",children:["Last updated: ",new Date(ie.lastUpdated).toLocaleString()]})]})]})]}),$.jsx("div",{className:"mt-8 no-print",children:$.jsx(_,{onPatternsUpdated:e=>{le(e),F("Training patterns updated from examples"),setTimeout(()=>F(""),3e3)}})})]})};function M(){const[e,t]=a.useState(!1);return a.useEffect(()=>{e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[e]),$.jsxs("div",{className:"min-h-screen "+(e?"dark bg-gray-900":"bg-gray-50"),children:[$.jsx("div",{className:"fixed top-4 right-4 z-50 no-print",children:$.jsx("button",{onClick:()=>t(!e),className:"p-2 bg-white dark:bg-gray-800 rounded-lg shadow-lg hover:shadow-xl transition-all","aria-label":"Toggle dark mode",children:e?$.jsx(C,{className:"h-5 w-5 text-yellow-500"}):$.jsx(E,{className:"h-5 w-5 text-gray-700"})})}),$.jsx(k,{})]})}s(L).createRoot(document.getElementById("root")).render($.jsx(A.StrictMode,{children:$.jsx(M,{})}));
